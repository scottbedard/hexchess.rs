import { describe, expect, test } from 'vitest'
import { Direction, Hexchess, Position } from '../src'
import { index, walk } from '../src/utils'

describe('walk', () => {
  test('stop at board edge', () => {
    const hexchess = new Hexchess()

    expect(walk(hexchess, index('f6'), 0, 'w')).toEqual([
      index('f7'),
      index('f8'),
      index('f9'),
      index('f10'),
      index('f11'),
    ])
  })

  test('stop before friendly piece', () => {
    const hexchess = Hexchess.parse('1/3/2P2/7/9/5R5/11/11/11/11/11 w - 0 1')

    expect(walk(hexchess, index('f6'), 0, 'w')).toEqual([
      index('f7'),
      index('f8'),
      // f9 is a friendly pawn
    ])
  })

  test('stop on hostile piece', () => {
    const hexchess = Hexchess.parse('1/3/2p2/7/9/5R5/11/11/11/11/11 w - 0 1')

    expect(walk(hexchess, index('f6'), 0, 'w')).toEqual([
      index('f7'),
      index('f8'),
      index('f9'), // <- f9 is a hostile pawn
    ])
  })

  test('walk perimeter positions in all directions', () => {
    const hexchess = new Hexchess()

    const assert = (from: Position, direction: Direction, expected: Position[]) => {
      expect(walk(hexchess, index(from), direction, 'w')).toEqual(expected.map(index))
    }

    assert('a1', 0, ['a2', 'a3', 'a4', 'a5', 'a6'])
    assert('a1', 1, ['b3', 'c5', 'd7', 'e9', 'f11'])
    assert('a1', 2, ['b2', 'c3', 'd4', 'e5', 'f6', 'g6', 'h6', 'i6', 'k6', 'l6'])
    assert('a1', 3, ['c2', 'e3', 'g3', 'i2', 'l1'])
    assert('a1', 4, ['b1', 'c1', 'd1', 'e1', 'f1'])
    assert('a1', 5, [])
    assert('a1', 6, [])
    assert('a1', 7, [])
    assert('a1', 8, [])
    assert('a1', 9, [])
    assert('a1', 10, [])
    assert('a1', 11, [])

    assert('a2', 0, ['a3', 'a4', 'a5', 'a6'])
    assert('a2', 1, ['b4', 'c6', 'd8', 'e10'])
    assert('a2', 2, ['b3', 'c4', 'd5', 'e6', 'f7', 'g7', 'h7', 'i7', 'k7'])
    assert('a2', 3, ['c3', 'e4', 'g4', 'i3', 'l2'])
    assert('a2', 4, ['b2', 'c2', 'd2', 'e2', 'f2', 'g1'])
    assert('a2', 5, ['b1'])
    assert('a2', 6, ['a1'])
    assert('a2', 7, [])
    assert('a2', 8, [])
    assert('a2', 9, [])
    assert('a2', 10, [])
    assert('a2', 11, [])

    assert('a3', 0, ['a4', 'a5', 'a6'])
    assert('a3', 1, ['b5', 'c7', 'd9'])
    assert('a3', 2, ['b4', 'c5', 'd6', 'e7', 'f8', 'g8', 'h8', 'i8'])
    assert('a3', 3, ['c4', 'e5', 'g5', 'i4', 'l3'])
    assert('a3', 4, ['b3', 'c3', 'd3', 'e3', 'f3', 'g2', 'h1'])
    assert('a3', 6, ['a2', 'a1'])
    assert('a3', 7, [])
    assert('a3', 8, [])
    assert('a3', 9, [])
    assert('a3', 10, [])
    assert('a3', 11, [])

    assert('a4', 0, ['a5', 'a6'])
    assert('a4', 1, ['b6', 'c8'])
    assert('a4', 2, ['b5', 'c6', 'd7', 'e8', 'f9', 'g9', 'h9'])
    assert('a4', 3, ['c5', 'e6', 'g6', 'i5', 'l4'])
    assert('a4', 4, ['b4', 'c4', 'd4', 'e4', 'f4', 'g3', 'h2', 'i1'])
    assert('a4', 5, ['b3', 'c2', 'd1'])
    assert('a4', 6, ['a3', 'a2', 'a1'])
    assert('a4', 7, [])
    assert('a4', 8, [])
    assert('a4', 9, [])
    assert('a4', 10, [])
    assert('a4', 11, [])

    assert('a5', 0, ['a6'])
    assert('a5', 1, ['b7'])
    assert('a5', 2, ['b6', 'c7', 'd8', 'e9', 'f10', 'g10'])
    assert('a5', 3, ['c6', 'e7', 'g7', 'i6', 'l5'])
    assert('a5', 4, ['b5', 'c5', 'd5', 'e5', 'f5', 'g4', 'h3', 'i2', 'k1'])
    assert('a5', 5, ['b4', 'c3', 'd2', 'e1'])
    assert('a5', 6, ['a4', 'a3', 'a2', 'a1'])
    assert('a5', 7, [])
    assert('a5', 8, [])
    assert('a5', 9, [])
    assert('a5', 10, [])
    assert('a5', 11, [])

    assert('a6', 0, [])
    assert('a6', 1, [])
    assert('a6', 2, ['b7', 'c8', 'd9', 'e10', 'f11'])
    assert('a6', 3, ['c7', 'e8', 'g8', 'i7', 'l6'])
    assert('a6', 4, ['b6', 'c6', 'd6', 'e6', 'f6', 'g5', 'h4', 'i3', 'k2', 'l1'])
    assert('a6', 5, ['b5', 'c4', 'd3', 'e2', 'f1'])
    assert('a6', 6, ['a5', 'a4', 'a3', 'a2', 'a1'])
    assert('a6', 7, [])
    assert('a6', 8, [])
    assert('a6', 9, [])
    assert('a6', 10, [])
    assert('a6', 11, [])

    assert('b7', 0, [])
    assert('b7', 1, [])
    assert('b7', 2, ['c8', 'd9', 'e10', 'f11'])
    assert('b7', 3, ['d8', 'f9', 'h8', 'k7'])
    assert('b7', 4, ['c7', 'd7', 'e7', 'f7', 'g6', 'h5', 'i4', 'k3', 'l2'])
    assert('b7', 5, ['c6', 'd5', 'e4', 'f3', 'g1'])
    assert('b7', 6, ['b6', 'b5', 'b4', 'b3', 'b2', 'b1'])
    assert('b7', 7, ['a5'])
    assert('b7', 8, ['a6'])
    assert('b7', 9, [])
    assert('b7', 10, [])
    assert('b7', 11, [])

    assert('c8', 0, [])
    assert('c8', 1, [])
    assert('c8', 2, ['d9', 'e10', 'f11'])
    assert('c8', 3, ['e9', 'g9', 'i8'])
    assert('c8', 4, ['d8', 'e8', 'f8', 'g7', 'h6', 'i5', 'k4', 'l3'])
    assert('c8', 5, ['d7', 'e6', 'f5', 'g3', 'h1'])
    assert('c8', 6, ['c7', 'c6', 'c5', 'c4', 'c3', 'c2', 'c1'])
    assert('c8', 7, ['b6', 'a4'])
    assert('c8', 8, ['b7', 'a6'])
    assert('c8', 9, [])
    assert('c8', 10, [])
    assert('c8', 11, [])

    assert('d9', 0, [])
    assert('d9', 1, [])
    assert('d9', 2, ['e10', 'f11'])
    assert('d9', 3, ['f10', 'h9'])
    assert('d9', 4, ['e9', 'f9', 'g8', 'h7', 'i6', 'k5', 'l4'])
    assert('d9', 5, ['e8', 'f7', 'g5', 'h3', 'i1'])
    assert('d9', 6, ['d8', 'd7', 'd6', 'd5', 'd4', 'd3', 'd2', 'd1'])
    assert('d9', 7, ['c7', 'b5', 'a3'])
    assert('d9', 8, ['c8', 'b7', 'a6'])
    assert('d9', 9, [])
    assert('d9', 10, [])
    assert('d9', 11, [])

    assert('e10', 0, [])
    assert('e10', 1, [])
    assert('e10', 2, ['f11'])
    assert('e10', 3, ['g10'])
    assert('e10', 4, ['f10', 'g9', 'h8', 'i7', 'k6', 'l5'])
    assert('e10', 5, ['f9', 'g7', 'h5', 'i3', 'k1'])
    assert('e10', 6, ['e9', 'e8', 'e7', 'e6', 'e5', 'e4', 'e3', 'e2', 'e1'])
    assert('e10', 7, ['d8', 'c6', 'b4', 'a2'])
    assert('e10', 8, ['d9', 'c8', 'b7', 'a6'])
    assert('e10', 9, [])
    assert('e10', 10, [])
    assert('e10', 11, [])

    assert('f11', 0, [])
    assert('f11', 1, [])
    assert('f11', 2, [])
    assert('f11', 3, [])
    assert('f11', 4, ['g10', 'h9', 'i8', 'k7', 'l6'])
    assert('f11', 5, ['g9', 'h7', 'i5', 'k3', 'l1'])
    assert('f11', 6, ['f10', 'f9', 'f8', 'f7', 'f6', 'f5', 'f4', 'f3', 'f2', 'f1'])
    assert('f11', 7, ['e9', 'd7', 'c5', 'b3', 'a1'])
    assert('f11', 8, ['e10', 'd9', 'c8', 'b7', 'a6'])
    assert('f11', 9, [])
    assert('f11', 10, [])
    assert('f11', 11, [])

    assert('g10', 0, [])
    assert('g10', 1, [])
    assert('g10', 2, [])
    assert('g10', 3, [])
    assert('g10', 4, ['h9', 'i8', 'k7', 'l6'])
    assert('g10', 5, ['h8', 'i6', 'k4', 'l2'])
    assert('g10', 6, ['g9', 'g8', 'g7', 'g6', 'g5', 'g4', 'g3', 'g2', 'g1'])
    assert('g10', 7, ['f9', 'e7', 'd5', 'c3', 'b1'])
    assert('g10', 8, ['f10', 'e9', 'd8', 'c7', 'b6', 'a5'])
    assert('g10', 9, ['e10'])
    assert('g10', 10, ['f11'])
    assert('g10', 11, [])

    assert('h9', 0, [])
    assert('h9', 1, [])
    assert('h9', 2, [])
    assert('h9', 3, [])
    assert('h9', 4, ['i8', 'k7', 'l6'])
    assert('h9', 5, ['i7', 'k5', 'l3'])
    assert('h9', 6, ['h8', 'h7', 'h6', 'h5', 'h4', 'h3', 'h2', 'h1'])
    assert('h9', 7, ['g8', 'f7', 'e5', 'd3', 'c1'])
    assert('h9', 8, ['g9', 'f9', 'e8', 'd7', 'c6', 'b5', 'a4'])
    assert('h9', 9, ['f10', 'd9'])
    assert('h9', 10, ['g10', 'f11'])
    assert('h9', 11, [])

    assert('i8', 0, [])
    assert('i8', 1, [])
    assert('i8', 2, [])
    assert('i8', 3, [])
    assert('i8', 4, ['k7', 'l6'])
    assert('i8', 5, ['k6', 'l4'])
    assert('i8', 6, ['i7', 'i6', 'i5', 'i4', 'i3', 'i2', 'i1'])
    assert('i8', 7, ['h7', 'g6', 'f5', 'e3', 'd1'])
    assert('i8', 8, ['h8', 'g8', 'f8', 'e7', 'd6', 'c5', 'b4', 'a3'])
    assert('i8', 9, ['g9', 'e9', 'c8'])
    assert('i8', 10, ['h9', 'g10', 'f11'])
    assert('i8', 11, [])

    assert('k7', 0, [])
    assert('k7', 1, [])
    assert('k7', 2, [])
    assert('k7', 3, [])
    assert('k7', 4, ['l6'])
    assert('k7', 5, ['l5'])
    assert('k7', 6, ['k6', 'k5', 'k4', 'k3', 'k2', 'k1'])
    assert('k7', 7, ['i6', 'h5', 'g4', 'f3', 'e1'])
    assert('k7', 8, ['i7', 'h7', 'g7', 'f7', 'e6', 'd5', 'c4', 'b3', 'a2'])
    assert('k7', 9, ['h8', 'f9', 'd8', 'b7'])
    assert('k7', 10, ['i8', 'h9', 'g10', 'f11'])
    assert('k7', 11, [])

    assert('l6', 0, [])
    assert('l6', 1, [])
    assert('l6', 2, [])
    assert('l6', 3, [])
    assert('l6', 4, [])
    assert('l6', 5, [])
    assert('l6', 6, ['l5', 'l4', 'l3', 'l2', 'l1'])
    assert('l6', 7, ['k5', 'i4', 'h3', 'g2', 'f1'])
    assert('l6', 8, ['k6', 'i6', 'h6', 'g6', 'f6', 'e5', 'd4', 'c3', 'b2', 'a1'])
    assert('l6', 9, ['i7', 'g8', 'e8', 'c7', 'a6'])
    assert('l6', 10, ['k7', 'i8', 'h9', 'g10', 'f11'])
    assert('l6', 11, [])

    assert('l5', 0, ['l6'])
    assert('l5', 1, [])
    assert('l5', 2, [])
    assert('l5', 3, [])
    assert('l5', 4, [])
    assert('l5', 5, [])
    assert('l5', 6, ['l4', 'l3', 'l2', 'l1'])
    assert('l5', 7, ['k4', 'i3', 'h2', 'g1'])
    assert('l5', 8, ['k5', 'i5', 'h5', 'g5', 'f5', 'e4', 'd3', 'c2', 'b1'])
    assert('l5', 9, ['i6', 'g7', 'e7', 'c6', 'a5'])
    assert('l5', 10, ['k6', 'i7', 'h8', 'g9', 'f10', 'e10'])
    assert('l5', 11, ['k7'])

    assert('l4', 0, ['l5', 'l6'])
    assert('l4', 1, [])
    assert('l4', 2, [])
    assert('l4', 3, [])
    assert('l4', 4, [])
    assert('l4', 5, [])
    assert('l4', 6, ['l3', 'l2', 'l1'])
    assert('l4', 7, ['k3', 'i2', 'h1'])
    assert('l4', 8, ['k4', 'i4', 'h4', 'g4', 'f4', 'e3', 'd2', 'c1'])
    assert('l4', 9, ['i5', 'g6', 'e6', 'c5', 'a4'])
    assert('l4', 10, ['k5', 'i6', 'h7', 'g8', 'f9', 'e9', 'd9'])
    assert('l4', 11, ['k6', 'i8'])

    assert('l3', 0, ['l4', 'l5', 'l6'])
    assert('l3', 1, [])
    assert('l3', 2, [])
    assert('l3', 3, [])
    assert('l3', 4, [])
    assert('l3', 5, [])
    assert('l3', 6, ['l2', 'l1'])
    assert('l3', 7, ['k2', 'i1'])
    assert('l3', 8, ['k3', 'i3', 'h3', 'g3', 'f3', 'e2', 'd1'])
    assert('l3', 9, ['i4', 'g5', 'e5', 'c4', 'a3'])
    assert('l3', 10, ['k4', 'i5', 'h6', 'g7', 'f8', 'e8', 'd8', 'c8'])
    assert('l3', 11, ['k5', 'i7', 'h9'])

    assert('l2', 0, ['l3', 'l4', 'l5', 'l6'])
    assert('l2', 1, [])
    assert('l2', 2, [])
    assert('l2', 3, [])
    assert('l2', 4, [])
    assert('l2', 5, [])
    assert('l2', 6, ['l1'])
    assert('l2', 7, ['k1'])
    assert('l2', 8, ['k2', 'i2', 'h2', 'g2', 'f2', 'e1'])
    assert('l2', 9, ['i3', 'g4', 'e4', 'c3', 'a2'])
    assert('l2', 10, ['k3', 'i4', 'h5', 'g6', 'f7', 'e7', 'd7', 'c7', 'b7'])
    assert('l2', 11, ['k4', 'i6', 'h8', 'g10'])

    assert('l1', 0, ['l2', 'l3', 'l4', 'l5', 'l6'])
    assert('l1', 1, [])
    assert('l1', 2, [])
    assert('l1', 3, [])
    assert('l1', 4, [])
    assert('l1', 5, [])
    assert('l1', 6, [])
    assert('l1', 7, [])
    assert('l1', 8, ['k1', 'i1', 'h1', 'g1', 'f1'])
    assert('l1', 9, ['i2', 'g3', 'e3', 'c2', 'a1'])
    assert('l1', 10, ['k2', 'i3', 'h4', 'g5', 'f6', 'e6', 'd6', 'c6', 'b6', 'a6'])
    assert('l1', 11, ['k3', 'i5', 'h7', 'g9', 'f11'])

    assert('k1', 0, ['k2', 'k3', 'k4', 'k5', 'k6', 'k7'])
    assert('k1', 1, ['l2'])
    assert('k1', 2, ['l1'])
    assert('k1', 3, [])
    assert('k1', 4, [])
    assert('k1', 5, [])
    assert('k1', 6, [])
    assert('k1', 7, [])
    assert('k1', 8, ['i1', 'h1', 'g1', 'f1'])
    assert('k1', 9, ['h2', 'f3', 'd2', 'b1'])
    assert('k1', 10, ['i2', 'h3', 'g4', 'f5', 'e5', 'd5', 'c5', 'b5', 'a5'])
    assert('k1', 11, ['i3', 'h5', 'g7', 'f9', 'e10'])

    assert('i1', 0, ['i2', 'i3', 'i4', 'i5', 'i6', 'i7', 'i8'])
    assert('i1', 1, ['k2', 'l3'])
    assert('i1', 2, ['k1', 'l1'])
    assert('i1', 3, [])
    assert('i1', 4, [])
    assert('i1', 5, [])
    assert('i1', 6, [])
    assert('i1', 7, [])
    assert('i1', 8, ['h1', 'g1', 'f1'])
    assert('i1', 9, ['g2', 'e2', 'c1'])
    assert('i1', 10, ['h2', 'g3', 'f4', 'e4', 'd4', 'c4', 'b4', 'a4'])
    assert('i1', 11, ['h3', 'g5', 'f7', 'e8', 'd9'])

    assert('h1', 0, ['h2', 'h3', 'h4', 'h5', 'h6', 'h7', 'h8', 'h9'])
    assert('h1', 1, ['i2', 'k3', 'l4'])
    assert('h1', 2, ['i1', 'k1', 'l1'])
    assert('h1', 3, [])
    assert('h1', 4, [])
    assert('h1', 5, [])
    assert('h1', 6, [])
    assert('h1', 7, [])
    assert('h1', 8, ['g1', 'f1'])
    assert('h1', 9, ['f2', 'd1'])
    assert('h1', 10, ['g2', 'f3', 'e3', 'd3', 'c3', 'b3', 'a3'])
    assert('h1', 11, ['g3', 'f5', 'e6', 'd7', 'c8'])

    assert('g1', 0, ['g2', 'g3', 'g4', 'g5', 'g6', 'g7', 'g8', 'g9', 'g10'])
    assert('g1', 1, ['h2', 'i3', 'k4', 'l5'])
    assert('g1', 2, ['h1', 'i1', 'k1', 'l1'])
    assert('g1', 3, [])
    assert('g1', 4, [])
    assert('g1', 5, [])
    assert('g1', 6, [])
    assert('g1', 7, [])
    assert('g1', 8, ['f1'])
    assert('g1', 9, ['e1'])
    assert('g1', 10, ['f2', 'e2', 'd2', 'c2', 'b2', 'a2'])
    assert('g1', 11, ['f3', 'e4', 'd5', 'c6', 'b7'])

    assert('f1', 0, ['f2', 'f3', 'f4', 'f5', 'f6', 'f7', 'f8', 'f9', 'f10', 'f11'])
    assert('f1', 1, ['g2', 'h3', 'i4', 'k5', 'l6'])
    assert('f1', 2, ['g1', 'h1', 'i1', 'k1', 'l1'])
    assert('f1', 3, [])
    assert('f1', 4, [])
    assert('f1', 5, [])
    assert('f1', 6, [])
    assert('f1', 7, [])
    assert('f1', 8, [])
    assert('f1', 9, [])
    assert('f1', 10, ['e1', 'd1', 'c1', 'b1', 'a1'])
    assert('f1', 11, ['e2', 'd3', 'c4', 'b5', 'a6'])

    assert('e1', 0, ['e2', 'e3', 'e4', 'e5', 'e6', 'e7', 'e8', 'e9', 'e10'])
    assert('e1', 1, ['f3', 'g4', 'h5', 'i6', 'k7'])
    assert('e1', 2, ['f2', 'g2', 'h2', 'i2', 'k2', 'l2'])
    assert('e1', 3, ['g1'])
    assert('e1', 4, ['f1'])
    assert('e1', 5, [])
    assert('e1', 6, [])
    assert('e1', 7, [])
    assert('e1', 8, [])
    assert('e1', 9, [])
    assert('e1', 10, ['d1', 'c1', 'b1', 'a1'])
    assert('e1', 11, ['d2', 'c3', 'b4', 'a5'])

    assert('d1', 0, ['d2', 'd3', 'd4', 'd5', 'd6', 'd7', 'd8', 'd9'])
    assert('d1', 1, ['e3', 'f5', 'g6', 'h7', 'i8'])
    assert('d1', 2, ['e2', 'f3', 'g3', 'h3', 'i3', 'k3', 'l3'])
    assert('d1', 3, ['f2', 'h1'])
    assert('d1', 4, ['e1', 'f1'])
    assert('d1', 5, [])
    assert('d1', 6, [])
    assert('d1', 7, [])
    assert('d1', 8, [])
    assert('d1', 9, [])
    assert('d1', 10, ['c1', 'b1', 'a1'])
    assert('d1', 11, ['c2', 'b3', 'a4'])

    assert('c1', 0, ['c2', 'c3', 'c4', 'c5', 'c6', 'c7', 'c8'])
    assert('c1', 1, ['d3', 'e5', 'f7', 'g8', 'h9'])
    assert('c1', 2, ['d2', 'e3', 'f4', 'g4', 'h4', 'i4', 'k4', 'l4'])
    assert('c1', 3, ['e2', 'g2', 'i1'])
    assert('c1', 4, ['d1', 'e1', 'f1'])
    assert('c1', 5, [])
    assert('c1', 6, [])
    assert('c1', 7, [])
    assert('c1', 8, [])
    assert('c1', 9, [])
    assert('c1', 10, ['b1', 'a1'])
    assert('c1', 11, ['b2', 'a3'])

    assert('b1', 0, ['b2', 'b3', 'b4', 'b5', 'b6', 'b7'])
    assert('b1', 1, ['c3', 'd5', 'e7', 'f9', 'g10'])
    assert('b1', 2, ['c2', 'd3', 'e4', 'f5', 'g5', 'h5', 'i5', 'k5', 'l5'])
    assert('b1', 3, ['d2', 'f3', 'h2', 'k1'])
    assert('b1', 4, ['c1', 'd1', 'e1', 'f1'])
    assert('b1', 5, [])
    assert('b1', 6, [])
    assert('b1', 7, [])
    assert('b1', 8, [])
    assert('b1', 9, [])
    assert('b1', 10, ['a1'])
    assert('b1', 11, ['a2'])
  })
})
